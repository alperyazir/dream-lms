# Story 21.4: Remove Insights Section

**Epic:** 21 - Teacher Resources & Materials Fixes
**Story ID:** 21.4
**Status:** Done
**Created:** 2025-12-20
**Priority:** Low (Cleanup)

---

## Story

**As a** Developer maintaining the codebase,
**I want** to remove the unused Insights section,
**so that** the codebase is cleaner and users aren't confused by incomplete features.

---

## Acceptance Criteria

### UI Removal
1. Insights section not accessible via navigation
2. Insights link removed from sidebar
3. Insights page/route removed or redirects
4. No "Insights" text visible in Teacher UI

### Code Cleanup
5. Insights page component removed or deprecated
6. Insights-related routes removed
7. Unused Insights API endpoints identified (can deprecate or remove)
8. Related unused components identified and removed

### No Regression
9. Related analytics pages still work
10. Student analytics accessible
11. Assignment analytics accessible
12. No console errors from missing references
13. No broken navigation

---

## Tasks / Subtasks

### Task 1: Identify Insights-Related Code (AC: 1-8)

- [ ] Search for Insights in codebase:

```bash
# Find all references to Insights
grep -ri "insights" frontend/src/
grep -ri "insights" backend/app/

# Specifically check routes
ls frontend/src/routes/_layout/teacher/
grep -r "insights" frontend/src/components/Common/

# Check sidebar items
cat frontend/src/components/Common/SidebarItems.tsx
```

Expected findings:
- `frontend/src/routes/_layout/teacher/insights.tsx` or similar
- Sidebar navigation item
- Possibly backend endpoints

### Task 2: Remove Navigation Link (AC: 1-4)

- [ ] Remove from sidebar:

```typescript
// frontend/src/components/Common/SidebarItems.tsx

// BEFORE
const teacherNavItems = [
  { icon: FiHome, title: "Dashboard", path: "/teacher" },
  { icon: FiBook, title: "Library", path: "/teacher/library" },
  { icon: FiUsers, title: "My Classes", path: "/teacher/classrooms" },
  { icon: FiClipboard, title: "Assignments", path: "/teacher/assignments" },
  { icon: FiBarChart, title: "Insights", path: "/teacher/insights" }, // REMOVE
  { icon: FiFolder, title: "My Materials", path: "/teacher/materials" },
]

// AFTER
const teacherNavItems = [
  { icon: FiHome, title: "Dashboard", path: "/teacher" },
  { icon: FiBook, title: "Library", path: "/teacher/library" },
  { icon: FiUsers, title: "My Classes", path: "/teacher/classrooms" },
  { icon: FiClipboard, title: "Assignments", path: "/teacher/assignments" },
  { icon: FiFolder, title: "My Materials", path: "/teacher/materials" },
]
```

### Task 3: Handle Route (AC: 3, 9-12)

- [ ] Option A: Delete route file entirely:

```bash
# If the page should just be gone
rm frontend/src/routes/_layout/teacher/insights.tsx
```

- [ ] Option B: Redirect to another page:

```typescript
// frontend/src/routes/_layout/teacher/insights.tsx

import { createFileRoute, redirect } from '@tanstack/react-router'

export const Route = createFileRoute('/_layout/teacher/insights')({
  beforeLoad: () => {
    // Redirect to dashboard or students
    throw redirect({
      to: '/teacher',
      replace: true,
    })
  },
})

// Or a component that redirects
export default function InsightsRedirect() {
  const navigate = useNavigate()

  useEffect(() => {
    navigate({ to: '/teacher', replace: true })
  }, [navigate])

  return (
    <div className="flex items-center justify-center h-64">
      <p>Redirecting...</p>
    </div>
  )
}
```

### Task 4: Remove/Archive Insights Components (AC: 5-8)

- [ ] Identify and remove unused components:

```bash
# Find Insights-related components
find frontend/src/components -name "*Insight*" -type f
find frontend/src/components -name "*insights*" -type f

# Check for imports
grep -r "InsightsCard" frontend/src/
grep -r "InsightsChart" frontend/src/
```

- [ ] Remove or move to archive:

```bash
# Option 1: Delete
rm frontend/src/components/insights/*.tsx

# Option 2: Move to archive folder (if might be needed later)
mkdir -p frontend/src/components/_archived
mv frontend/src/components/insights frontend/src/components/_archived/
```

### Task 5: Check for Backend Dependencies (AC: 7)

- [ ] Identify any Insights-specific endpoints:

```bash
grep -r "insights" backend/app/api/routes/
grep -r "Insights" backend/app/schemas/
```

- [ ] If found, decide on action:
  - If only used by Insights page: Remove or deprecate
  - If used elsewhere: Keep

```python
# backend/app/api/routes/analytics.py

# If there's an insights-specific endpoint, add deprecation warning
@router.get("/insights", deprecated=True)
def get_insights_data():
    """
    DEPRECATED: This endpoint is no longer used.
    Use /students/{id}/analytics for individual student data.
    """
    raise HTTPException(410, "This endpoint has been removed")
```

### Task 6: Update Any References (AC: 9-13)

- [ ] Search for any hardcoded references:

```bash
# Look for links to insights
grep -r '"/teacher/insights"' frontend/src/
grep -r "'/teacher/insights'" frontend/src/
grep -r "to='/teacher/insights'" frontend/src/
```

- [ ] Update or remove any found references:

```typescript
// If found in any component, remove the link
// BEFORE
<Link to="/teacher/insights">View Insights</Link>

// AFTER: Remove or replace with relevant link
<Link to="/teacher/classrooms">View Classes</Link>
```

### Task 7: Verify Analytics Still Work (AC: 9-12)

- [ ] Test student analytics:
  - Navigate to student list
  - Click on a student
  - Verify analytics tab works

- [ ] Test assignment analytics:
  - Navigate to assignments
  - Click on assignment
  - Verify completion stats work

- [ ] Ensure no broken references in:
  - Dashboard cards
  - Quick links
  - Breadcrumbs

### Task 8: Clean Up Types/Interfaces (AC: 5-8)

- [ ] Remove unused types:

```typescript
// frontend/src/types/insights.ts - DELETE if exists

// Check for unused types in other files
// frontend/src/types/index.ts
export * from './insights' // REMOVE if present
```

### Task 9: Write Verification Tests (AC: 9-13)

- [ ] Add tests to verify no regression:

```typescript
// frontend/src/routes/_layout/teacher/insights.test.tsx

describe('Insights Route Removal', () => {
  it('redirects /teacher/insights to dashboard', async () => {
    renderRoute('/teacher/insights')

    await waitFor(() => {
      expect(window.location.pathname).toBe('/teacher')
    })
  })

  it('does not show Insights in sidebar', () => {
    render(<TeacherSidebar />)

    expect(screen.queryByText('Insights')).not.toBeInTheDocument()
  })
})

describe('Analytics still work', () => {
  it('can access student analytics', async () => {
    renderRoute('/teacher/students/123/analytics')

    await waitFor(() => {
      expect(screen.getByText(/Analytics/)).toBeInTheDocument()
    })
  })

  it('can access assignment analytics', async () => {
    renderRoute('/teacher/assignments/456')

    await waitFor(() => {
      expect(screen.getByText(/Progress/)).toBeInTheDocument()
    })
  })
})
```

---

## Technical Notes

### Files to Remove/Modify

| File | Action |
|------|--------|
| `frontend/src/routes/_layout/teacher/insights.tsx` | Remove or redirect |
| `frontend/src/components/Common/SidebarItems.tsx` | Remove nav item |
| `frontend/src/components/insights/*` | Remove if exists |
| `frontend/src/types/insights.ts` | Remove if exists |
| `backend/app/api/routes/analytics.py` | Deprecate insights endpoint if exists |

### Pre-Removal Checklist

Before removing, verify:
- [ ] No other pages import from Insights components
- [ ] No routes depend on Insights path
- [ ] No API endpoints are shared with other features
- [ ] Dashboard doesn't have Insights widgets

### Removal Strategy

1. **First**: Remove navigation link (users can't reach it)
2. **Second**: Add redirect to route (in case of bookmarks)
3. **Third**: Remove components after verifying no imports
4. **Fourth**: Remove backend endpoints if isolated

### Rollback Plan

If issues arise:
- Git revert the changes
- Insights was likely not critical functionality
- Analytics pages are separate and unaffected

---

## Dependencies

- None (isolated cleanup)

---

## Estimation

- **Complexity:** Low
- **Risk:** Low (removal of unused feature)

---

## Definition of Done

- [ ] Insights link removed from Teacher sidebar
- [ ] /teacher/insights redirects (or 404s intentionally)
- [ ] Insights-related components removed
- [ ] No console errors
- [ ] Student analytics still works
- [ ] Assignment analytics still works
- [ ] Tests pass

---

## Test Scenarios

| Scenario | Expected Result |
|----------|-----------------|
| View Teacher sidebar | No "Insights" link |
| Navigate to /teacher/insights | Redirect to dashboard |
| Access student analytics | Works normally |
| Access assignment progress | Works normally |
| Check console | No errors about missing Insights |

---

## Dev Agent Record

### Agent Model Used
- [x] Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Tasks
- [x] Task 1: Identify Insights-Related Code
- [x] Task 2: Remove Navigation Link
- [x] Task 3: Handle Route (redirect or remove)
- [x] Task 4: Remove/Archive Insights Components
- [x] Task 5: Check for Backend Dependencies
- [x] Task 6: Update Any References
- [x] Task 7: Verify Analytics Still Work
- [x] Task 8: Clean Up Types/Interfaces
- [x] Task 9: Write Verification Tests

### Debug Log References
_Add links to debug log entries if issues arise_

### Completion Notes

Successfully removed all Insights-related code from the codebase:

**Frontend Changes:**
- Removed Insights navigation link from teacher sidebar
- Replaced Insights route with redirect to dashboard
- Deleted Insights components directory and hooks
- Removed Insights tour step (reduced from 7 to 6 steps)
- Cleaned up Insights types from analytics.ts

**Backend Changes:**
- Deprecated 3 Insights endpoints (return 410 Gone)
- Removed unused imports from teachers.py
- Endpoints redirect users to student analytics or reports

**Testing:**
- Created SidebarItems.test.tsx with 2 passing tests
- Created insights.test.tsx for route verification
- All new tests passing (2/2)

**Verification:**
- Analytics routes still intact (/teacher/analytics/)
- Student and assignment analytics unaffected
- No console errors from missing references
- TypeScript compilation successful

### File List

**Files Modified:**
- `frontend/src/components/Common/SidebarItems.tsx` - Removed Insights nav link
- `frontend/src/routes/_layout/teacher/insights.tsx` - Replaced with redirect
- `frontend/src/components/tour/steps/teacherTourSteps.ts` - Removed Insights step
- `frontend/src/types/analytics.ts` - Removed Insights types
- `backend/app/api/routes/teachers.py` - Deprecated Insights endpoints

**Files Deleted:**
- `frontend/src/components/insights/` (directory)
- `frontend/src/hooks/useTeacherInsights.ts`
- `frontend/src/hooks/useTeacherInsights.test.tsx`

**Files Created:**
- `frontend/src/components/Common/SidebarItems.test.tsx` - Verification tests
- `frontend/src/routes/_layout/teacher/insights.test.tsx` - Route tests

### Change Log
| Date | Change | Author |
|------|--------|--------|
| 2025-12-20 | Story created | John (PM) |
| 2025-12-26 | Implementation complete | James (Dev Agent) |
