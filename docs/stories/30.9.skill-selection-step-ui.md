# Story 30.9: Skill Selection Step UI

**Status:** Ready for Review
**Epic:** Epic 30 - Skill-Based AI Assignment Generation & Reporting
**Story Points:** 5
**Priority:** High (Frontend entry point for new flow)
**Dependencies:** Story 30.1 (Skills API endpoint), Story 30.3 (V2 generation API)

---

## User Story

As a **teacher**,
I want **to select a language skill as the first step when generating an AI assignment**,
So that **I can intentionally target the skill I want my students to practice**.

---

## Acceptance Criteria

1. [ ] 6 skill cards displayed: 5 active (Listening, Reading, Writing, Vocabulary, Grammar) + Mix
2. [ ] Speaking card shown as visually disabled with "Coming Soon" label
3. [ ] Only one skill can be selected at a time (radio behavior)
4. [ ] Selected skill is visually highlighted (border, background, or scale)
5. [ ] Selecting Mix proceeds directly to configuration step (skips format selection)
6. [ ] Responsive layout for different screen sizes (grid: 3×2 on desktop, 2×3 on tablet, 1×6 on mobile)
7. [ ] Skills fetched from `GET /api/v1/skills/` API (not hardcoded)

---

## Tasks & Subtasks

- [x] **Task 1: Create SkillSelectionGrid Component** (AC: 1, 2, 3, 4)
  - [x] Create `frontend/src/components/DreamAI/SkillSelectionGrid.tsx`
  - [x] Renders active skills from API + Mix card + disabled Speaking card
  - [x] Single selection: clicking a card deselects the previous
  - [x] Loading state with spinner

- [x] **Task 2: Create SkillCard Component** (AC: 2, 4)
  - [x] Create `frontend/src/components/DreamAI/SkillCard.tsx`
  - [x] Icon mapping from API string → Lucide component
  - [x] Color mapping from API string → Tailwind gradient/bg/border classes
  - [x] Selected state: ring-2, scale-[1.02], bg accent
  - [x] Disabled state: opacity-50, cursor-not-allowed, grayscale + badge

- [x] **Task 3: Integrate into DreamAI Question Generator** (AC: 1, 5, 7)
  - [x] Modified GenerateContentDialog to add Step 2 (Select Skill)
  - [x] Wizard now has 5 steps: Book → Modules → Skill → Activity Type → Review
  - [x] Skills fetched from `GET /api/v1/skills/` on dialog open
  - [x] Mix selection skips format step → goes directly to generation
  - [x] Added `skillSlug` to `useGenerationState` form state

- [x] **Task 4: Add TypeScript Types** (AC: 7)
  - [x] Created `frontend/src/types/skill.ts` with SkillCategory, ActivityFormat, SkillWithFormats

- [x] **Task 5: API Service Method** (AC: 7)
  - [x] Created `frontend/src/services/skillsApi.ts` with `getSkills()` function

- [x] **Task 6: Responsive Layout** (AC: 6)
  - [x] Grid classes: `grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4`

- [ ] **Task 7: Unit Tests** (AC: 1-6)
  - [ ] Deferred: Frontend uses Vitest/RTL but test infrastructure has pre-existing issues
  - [ ] Components verified via TypeScript compilation + Vite build

---

## Dev Notes

### Relevant Source Tree
- DreamAI components: `frontend/src/components/dreamai/` or similar location
- Question Generator UI: likely in DreamAI section (Story 27.17 area)
- UI primitives: `frontend/src/components/ui/` (Card, Badge from Shadcn) [Source: source-tree.md#frontend-structure]
- Types: `frontend/src/types/` [Source: source-tree.md#frontend-structure]
- Services: `frontend/src/services/` or `frontend/src/client/` [Source: source-tree.md]

### Icon Mapping
Map skill `icon` strings to Lucide React components:
- "ear" → `<Ear />`, "book-open" → `<BookOpen />`, "pencil" → `<Pencil />`
- "mic" → `<Mic />`, "text" → `<Type />`, "braces" → `<Braces />`
- Mix: "shuffle" → `<Shuffle />`

### Color System
Reuse the existing `activityTypeConfig.ts` color mapping pattern. Each skill has a Tailwind color key that maps to bg/text/border classes. [Source: activityTypeConfig.ts pattern from FlowbookViewer]

### Existing UI Patterns
- Cards use Shadcn Card component [Source: tech-stack.md — Shadcn UI]
- Badges use Shadcn Badge component
- State management: selection state is local (React useState), not Zustand

### Testing
- Test file: `frontend/src/components/dreamai/SkillSelectionGrid.test.tsx`
- Use React Testing Library [Source: 10-testing-strategy.md#frontend-testing]
- Mock API response for skills list

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.6

### File List
| File | Action | Description |
|------|--------|-------------|
| `frontend/src/types/skill.ts` | Created | SkillCategory, ActivityFormat, SkillWithFormats types |
| `frontend/src/services/skillsApi.ts` | Created | `getSkills()` API service |
| `frontend/src/components/DreamAI/SkillCard.tsx` | Created | Individual skill card with icon/color mapping |
| `frontend/src/components/DreamAI/SkillSelectionGrid.tsx` | Created | Grid of skill cards with Mix + Speaking |
| `frontend/src/components/DreamAI/GenerateContentDialog.tsx` | Modified | Added Step 2 (Select Skill), shifted subsequent steps |
| `frontend/src/components/DreamAI/index.ts` | Modified | Added SkillCard, SkillSelectionGrid exports |
| `frontend/src/hooks/useGenerationState.ts` | Modified | Added skillSlug field and setSkillSlug callback |

### Completion Notes
- 6 of 7 tasks implemented (Task 7 deferred due to pre-existing frontend test infra issues)
- TypeScript compilation clean, Vite build succeeds
- Wizard flow expanded from 4 to 5 steps with skill selection between modules and activity type
- Mix mode skips format selection and goes directly to generation

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-12 | 1.0 | Initial story draft | SM Agent (Bob) |
| 2026-02-13 | 1.1 | Implementation complete — Tasks 1-6 done, TS clean, Vite builds | Dev Agent (James) |
