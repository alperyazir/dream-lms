# Story 20.4: Activity Selection UI Fixes

**Epic:** 20 - Assignment Management Enhancements
**Story ID:** 20.4
**Status:** Ready for Review
**Created:** 2025-12-20
**Priority:** High (Bug Fix)

---

## Story

**As a** Teacher creating assignments,
**I want** a cleaner activity selection experience,
**so that** I'm not confused by inactive buttons and understand the impact of my choices.

---

## Acceptance Criteria

### Remove Inactive Eye Icon
1. Eye/preview icon removed from selected activities panel
2. No inactive/disabled buttons shown in selection area
3. Preview functionality available elsewhere (not in selection)

### Time Planning Warning
4. When enabling Time Planning with activities already selected, show warning
5. Warning dialog explains activities will be cleared
6. User can confirm (clear activities, enable Time Planning)
7. User can cancel (keep activities, Time Planning stays off)
8. Warning only shown when activities exist

### Time Planning Behavior
9. If Time Planning enabled first, activities selected via Time Planning UI
10. If activities selected first, enable Time Planning clears them
11. Clear visual indication of Time Planning mode

---

## Tasks / Subtasks

### Task 1: Remove Eye Icon from Selected Activities (AC: 1-3)

- [x] Find selected activities display in Create Assignment dialog
- [x] Remove or hide the eye/preview icon
- [x] Verify activity info still displayed (title, type, etc.)

**Current (with inactive icon):**
```tsx
<div className="selected-activity">
  <span>{activity.title}</span>
  <Button variant="ghost" disabled> {/* Remove this */}
    <Eye className="h-4 w-4" />
  </Button>
  <Button variant="ghost" onClick={() => removeActivity(activity.id)}>
    <X className="h-4 w-4" />
  </Button>
</div>
```

**Fixed:**
```tsx
<div className="selected-activity flex items-center justify-between">
  <div>
    <span className="font-medium">{activity.title}</span>
    <Badge variant="secondary" className="ml-2">
      {getActivityTypeLabel(activity.activity_type)}
    </Badge>
  </div>
  <Button variant="ghost" size="sm" onClick={() => removeActivity(activity.id)}>
    <X className="h-4 w-4" />
  </Button>
</div>
```

### Task 2: Create Time Planning Warning Dialog (AC: 4-8)

- [x] Create confirmation dialog component:

```typescript
// frontend/src/components/assignments/TimePlanningWarningDialog.tsx

interface TimePlanningWarningDialogProps {
  open: boolean
  onConfirm: () => void
  onCancel: () => void
  activityCount: number
}

export function TimePlanningWarningDialog({
  open,
  onConfirm,
  onCancel,
  activityCount,
}: TimePlanningWarningDialogProps) {
  return (
    <AlertDialog open={open}>
      <AlertDialogContent>
        <AlertDialogHeader>
          <AlertDialogTitle>Enable Time Planning?</AlertDialogTitle>
          <AlertDialogDescription>
            You currently have {activityCount} activit{activityCount === 1 ? 'y' : 'ies'} selected.
            <br /><br />
            Enabling Time Planning will <strong>remove your selected activities</strong> because
            Time Planning uses a different activity selection method (by time sessions).
            <br /><br />
            Do you want to continue?
          </AlertDialogDescription>
        </AlertDialogHeader>
        <AlertDialogFooter>
          <AlertDialogCancel onClick={onCancel}>
            Keep Activities
          </AlertDialogCancel>
          <AlertDialogAction onClick={onConfirm}>
            Enable & Clear Activities
          </AlertDialogAction>
        </AlertDialogFooter>
      </AlertDialogContent>
    </AlertDialog>
  )
}
```

### Task 3: Update Time Planning Toggle Handler (AC: 4-8)

- [x] Modify the toggle handler to show warning:

```typescript
// In CreateAssignmentDialog or relevant step component

const [showTimePlanningWarning, setShowTimePlanningWarning] = useState(false)

const handleTimePlanningToggle = (enabled: boolean) => {
  if (enabled && selectedActivities.length > 0) {
    // Show warning dialog
    setShowTimePlanningWarning(true)
  } else {
    setTimePlanningEnabled(enabled)
  }
}

const handleTimePlanningWarningConfirm = () => {
  setSelectedActivities([])
  setTimePlanningEnabled(true)
  setShowTimePlanningWarning(false)
}

const handleTimePlanningWarningCancel = () => {
  setShowTimePlanningWarning(false)
  // Don't change anything
}

// In JSX:
<TimePlanningWarningDialog
  open={showTimePlanningWarning}
  onConfirm={handleTimePlanningWarningConfirm}
  onCancel={handleTimePlanningWarningCancel}
  activityCount={selectedActivities.length}
/>
```

### Task 4: Add Visual Indication for Time Planning Mode (AC: 11)

- [x] When Time Planning is enabled, show clear indication:

```tsx
{timePlanningEnabled && (
  <div className="bg-blue-50 border border-blue-200 rounded-md p-3 mb-4">
    <div className="flex items-center gap-2 text-blue-700">
      <Clock className="h-4 w-4" />
      <span className="font-medium">Time Planning Mode</span>
    </div>
    <p className="text-sm text-blue-600 mt-1">
      Activities will be selected based on time sessions, not manually.
    </p>
  </div>
)}
```

### Task 5: Write Tests (AC: 1-11)

- [x] Test eye icon not present in selected activities
- [x] Test warning shows when toggling Time Planning with activities
- [x] Test confirm clears activities
- [x] Test cancel keeps activities
- [x] Test no warning when no activities selected

```typescript
describe('Activity Selection', () => {
  it('does not show preview icon on selected activities', () => {
    render(<CreateAssignmentDialog {...props} />)
    // Select an activity
    // Verify no eye icon in selected panel
  })

  it('shows warning when enabling Time Planning with activities', async () => {
    render(<CreateAssignmentDialog {...props} />)
    // Select activities
    // Toggle Time Planning
    expect(screen.getByText(/Enable Time Planning\?/)).toBeInTheDocument()
  })

  it('clears activities when confirming Time Planning', async () => {
    render(<CreateAssignmentDialog {...props} />)
    // Select activities
    // Toggle Time Planning
    // Click confirm
    expect(selectedActivities).toHaveLength(0)
  })

  it('keeps activities when canceling Time Planning', async () => {
    render(<CreateAssignmentDialog {...props} />)
    // Select 3 activities
    // Toggle Time Planning
    // Click cancel
    expect(selectedActivities).toHaveLength(3)
  })
})
```

---

## Technical Notes

### Files to Modify

| File | Changes |
|------|---------|
| `frontend/src/components/assignments/CreateAssignmentDialog.tsx` | Remove eye icon, add warning logic |
| `frontend/src/components/assignments/StepSelectBook.tsx` | If eye icon is here |
| `frontend/src/components/assignments/StepSelectActivity.tsx` | Activity selection changes |

### Files to Create

| File | Description |
|------|-------------|
| `frontend/src/components/assignments/TimePlanningWarningDialog.tsx` | Warning dialog |

### Component Location

The eye icon might be in:
- `StepSelectBook.tsx` or `StepSelectBookActivity.tsx`
- A selected activities list component
- The right panel showing selected items

Search for "Eye" or "preview" in assignment components.

---

## Dependencies

- None (standalone bug fixes)

---

## Estimation

- **Complexity:** Low
- **Components:** Minor modifications + 1 new dialog

---

## Definition of Done

- [x] No inactive eye icon on selected activities
- [x] Warning dialog shows when enabling Time Planning with activities
- [x] Confirm clears activities and enables Time Planning
- [x] Cancel keeps activities and doesn't enable Time Planning
- [x] Visual indication when in Time Planning mode
- [x] Tests pass

---

## Test Scenarios

| Scenario | Expected Result |
|----------|-----------------|
| Select activities, view selected panel | No eye icon visible |
| Enable Time Planning with 0 activities | Time Planning enables, no warning |
| Enable Time Planning with 3 activities | Warning dialog shown |
| Confirm warning | Activities cleared, Time Planning on |
| Cancel warning | Activities kept, Time Planning off |

---

## Dev Agent Record

### Agent Model Used
- [x] Claude Sonnet 4.5 (claude-sonnet-4-5-20250929) - 2025-12-24

### Tasks
_Checkboxes updated during implementation_

### Debug Log References
_No issues encountered_

### Completion Notes
All tasks completed successfully:
- Removed inactive Eye/preview icon from selected activities panel in both Time Planning and Normal modes
- Created TimePlanningWarningDialog component with proper warning message and action buttons
- Updated Time Planning toggle handler to show warning when activities are already selected
- Added visual indication banner when Time Planning mode is enabled
- All tests passing (ActivitySelectionTabs: 14/14, TimePlanningWarningDialog: 5/5)
- TypeScript compilation successful
- Linter auto-formatted all modified files

### File List
**Modified:**
- frontend/src/components/assignments/ActivitySelectionTabs.tsx
- frontend/src/components/assignments/StepSelectActivities.tsx
- frontend/src/components/assignments/AssignmentCreationDialog.tsx
- frontend/src/components/assignments/ActivitySelectionTabs.test.tsx

**Created:**
- frontend/src/components/assignments/TimePlanningWarningDialog.tsx
- frontend/src/components/assignments/TimePlanningWarningDialog.test.tsx
- frontend/src/components/assignments/AssignmentCreationDialog.timeplanning.test.tsx

### Change Log
| Date | Change | Author |
|------|--------|--------|
| 2025-12-20 | Story created | John (PM) |
| 2025-12-24 | Implementation completed | James (Dev Agent) |

---

## QA Results

### Review Date: 2025-12-26
### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment
**Overall:** Excellent implementation with proper UI/UX fixes and comprehensive test coverage (19 tests). Clean component design with proper separation of concerns.

**Strengths:**
- Removed confusing inactive eye icon from UI
- Created dedicated TimePlanningWarningDialog component
- Proper warning when toggling time planning with selected activities
- 19 tests passing (14 ActivitySelectionTabs + 5 TimePlanningWarning)
- Clean component architecture

### Compliance Check
- **All ACs Met:** ✓ PASS

### Gate Status
**Gate:** PASS → docs/qa/gates/20.4-activity-selection-ui-fixes.yml

### Recommended Status
**✓ Ready for Done** - All fixes implemented correctly with good test coverage.

