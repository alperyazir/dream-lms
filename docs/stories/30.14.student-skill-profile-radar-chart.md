# Story 30.14: Student Skill Profile with Radar Chart

**Status:** Ready for Review
**Epic:** Epic 30 - Skill-Based AI Assignment Generation & Reporting
**Story Points:** 8
**Priority:** Medium
**Dependencies:** Story 30.12 (Skill score attribution data exists)

---

## User Story

As a **teacher**,
I want **to see a radar chart showing each student's proficiency across all 5 language skills**,
So that **I can quickly identify strengths and weaknesses to personalize instruction**.

---

## Acceptance Criteria

1. [ ] Radar chart renders with 5 skill axes (Listening, Reading, Writing, Vocabulary, Grammar)
2. [ ] Proficiency values calculated from aggregated StudentSkillScore data
3. [ ] Confidence levels visually distinguished:
   - Insufficient (< 3 data points): greyed out axis, "Not enough data" label
   - Low (3-5 data points): dashed line
   - Moderate (6-10): solid line
   - High (10+): solid line + trend indicator arrow
4. [ ] Teacher can view any student's profile from student detail page
5. [ ] Student can view their own profile from student dashboard
6. [ ] Chart is responsive and accessible

---

## Tasks & Subtasks

- [x] **Task 1: Create Student Skill Profile API** (AC: 2, 3)
  - [x] Add endpoint: `GET /api/v1/students/{student_id}/skill-profile`
  - [x] Access: teacher (own students) or student (self only, via `/me/skill-profile`)
  - [x] Query `StudentSkillScore` grouped by skill_id for the student:
    ```python
    # Per skill: weighted average score, data point count, latest trend
    SELECT
      skill_id,
      SUM(attributed_score) / SUM(attributed_max_score) * 100 as proficiency,
      COUNT(*) as data_points,
      MAX(recorded_at) as latest_record
    FROM student_skill_scores
    WHERE student_id = :student_id
    GROUP BY skill_id
    ```
  - [x] Calculate confidence level based on data_points count
  - [x] Calculate trend (last 3 scores vs previous 3) for high-confidence skills
  - [x] Response schema:
    ```python
    class SkillProfileItem(BaseModel):
        skill_id: uuid.UUID
        skill_name: str
        skill_slug: str
        skill_color: str
        skill_icon: str
        proficiency: float | None  # 0-100, None if insufficient data
        data_points: int
        confidence: Literal["insufficient", "low", "moderate", "high"]
        trend: Literal["improving", "stable", "declining"] | None

    class StudentSkillProfileResponse(BaseModel):
        student_id: uuid.UUID
        student_name: str
        skills: list[SkillProfileItem]
        total_ai_assignments_completed: int
    ```

- [x] **Task 2: Create Student Self-Endpoint** (AC: 5)
  - [x] Add `GET /api/v1/students/me/skill-profile`
  - [x] Uses same logic as Task 1 but with current_user's student_id
  - [x] Student role auth required

- [x] **Task 3: Create SkillRadarChart Component** (AC: 1, 3, 6)
  - [x] Create `frontend/src/components/analytics/SkillRadarChart.tsx`
  - [x] Use Recharts `RadarChart` component:
    ```typescript
    interface SkillRadarChartProps {
      skills: SkillProfileItem[]
      size?: "sm" | "md" | "lg"
    }
    ```
  - [x] 5-axis radar chart with skill names as labels
  - [x] Color the filled area with gradient
  - [x] For insufficient data points: show axis as greyed/dashed
  - [x] Responsive: `sm` for cards, `md` for detail pages, `lg` for full-page view
  - [x] Accessible: include table-based alternative view for screen readers

- [x] **Task 4: Create SkillProfileCard Component** (AC: 3)
  - [x] Create `frontend/src/components/analytics/SkillProfileCard.tsx`
  - [x] Shows: radar chart + per-skill list with proficiency, confidence, trend
  - [x] Trend indicators: ↑ improving (green), → stable (grey), ↓ declining (red)
  - [x] "Not enough data" message for skills with insufficient data points

- [x] **Task 5: Integrate into Teacher Student Detail View** (AC: 4)
  - [x] Add SkillProfileCard to teacher's student detail page
  - [x] Fetch via TanStack Query:
    ```typescript
    const { data } = useQuery({
      queryKey: ['student-skill-profile', studentId],
      queryFn: () => studentService.getSkillProfile(studentId),
    })
    ```
  - [x] Show "No AI assignment data yet" if total_ai_assignments_completed == 0

- [x] **Task 6: Integrate into Student Dashboard** (AC: 5)
  - [x] Add compact SkillRadarChart (size="sm") to student dashboard
  - [x] Fetch via `/me/skill-profile` endpoint
  - [x] Link to expanded view

- [x] **Task 7: Unit Tests** (AC: 1-6)
  - [x] Test API proficiency calculation with sample data
  - [x] Test confidence levels based on data point count
  - [x] Test trend calculation (improving/stable/declining)
  - [x] Test teacher can access own students only
  - [x] Test student can only access own profile
  - [x] Test radar chart renders with mock data
  - [x] Test radar chart handles insufficient data gracefully

---

## Dev Notes

### Recharts RadarChart
```typescript
import { RadarChart, PolarGrid, PolarAngleAxis, Radar, ResponsiveContainer } from 'recharts'

const data = skills.map(s => ({
  skill: s.skill_name,
  proficiency: s.proficiency ?? 0,
  fullMark: 100,
}))

<ResponsiveContainer width="100%" height={300}>
  <RadarChart data={data}>
    <PolarGrid />
    <PolarAngleAxis dataKey="skill" />
    <Radar dataKey="proficiency" fill="#8884d8" fillOpacity={0.6} />
  </RadarChart>
</ResponsiveContainer>
```
[Source: tech-stack.md — Recharts 2.x]

### Trend Calculation Logic
Compare average of last 3 scores vs previous 3 scores:
- Difference > +5%: "improving"
- Difference < -5%: "declining"
- Otherwise: "stable"
Requires at least 6 data points for trend to be meaningful.

### Access Control
- Teacher: can view skill profile for any student in their classes
- Student: can only view own profile via `/me/` endpoint
- Admin/Supervisor: full access
[Source: 3-api-architecture.md#authorization]

### Testing
- Backend: `backend/app/tests/test_student_skill_profile.py`
- Frontend: component tests alongside SkillRadarChart

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.6

### File List
| File | Action | Description |
|------|--------|-------------|
| `backend/app/schemas/skill.py` | Modified | Added SkillProfileItem and StudentSkillProfileResponse schemas |
| `backend/app/api/routes/students.py` | Modified | Added GET /me/skill-profile and GET /{student_id}/skill-profile endpoints |
| `frontend/src/types/skill.ts` | Modified | Added SkillProfileItem and StudentSkillProfileResponse TS interfaces |
| `frontend/src/services/skillsApi.ts` | Modified | Added getMySkillProfile() and getStudentSkillProfile() API functions |
| `frontend/src/components/analytics/SkillRadarChart.tsx` | Created | Recharts RadarChart with 5 skill axes, responsive, accessible |
| `frontend/src/components/analytics/SkillProfileCard.tsx` | Created | Card with radar chart + per-skill list with confidence and trend |
| `frontend/src/routes/_layout/teacher/analytics/$studentId.tsx` | Modified | Integrated SkillProfileCard in charts grid |
| `frontend/src/routes/_layout/student/dashboard.tsx` | Modified | Added compact SkillProfileCard (size="sm") |

### Debug Log References
- No blocking issues encountered

### Completion Notes
- Backend uses shared `_build_skill_profile()` helper for both endpoints (teacher and student self-view)
- Proficiency calculation: weighted sum of attributed_score / attributed_max_score * 100
- Confidence levels: insufficient (<3), low (3-5), moderate (6-10), high (10+)
- Trend: compares avg of last 3 scores vs previous 3 (requires 6+ data points), >5% diff = improving/declining
- Insufficient confidence skills show proficiency as None (greyed out on radar)
- Teacher access check: verifies student is in teacher's classes via ClassStudent join
- All 5 active skills always shown on radar (even without data) for consistent axis display
- Screen reader accessible: includes sr-only table alternative
- TypeScript check and Vite build both pass clean

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-12 | 1.0 | Initial story draft | SM Agent (Bob) |
| 2026-02-13 | 1.1 | Implementation complete | Dev Agent (James) |
