# Story 19.6: Enhanced Cards with List View Option

**Epic:** 19 - Library View Enhancements
**Story ID:** 19.6
**Status:** Done
**Created:** 2025-12-20
**Priority:** Low

---

## Story

**As a** Publisher managing schools and teachers,
**I want** enhanced cards with more details and a list view option,
**so that** I can quickly see relevant information and manage larger datasets efficiently.

---

## Acceptance Criteria

### School Cards Enhancement (Publisher View)
1. School cards show teacher count
2. School cards show student count
3. School cards show book assignment count
4. School cards have consistent styling with Library cards

### School List View
5. Grid/list toggle available for Schools page
6. List view shows compact rows with all info
7. View preference persists (localStorage)

### Teacher Cards Enhancement (Publisher View)
8. Teacher cards show number of books assigned
9. Teacher cards show school name
10. Teacher cards show number of classes/classrooms
11. Teacher cards have consistent styling

### Teacher List View
12. Grid/list toggle available for Teachers page
13. List view shows compact rows with all info
14. List view supports column sorting

### Teacher Filters
15. Filter by school dropdown
16. Filter by status (active/inactive if applicable)
17. Search by name/email
18. Filters work in both grid and list views

---

## Tasks / Subtasks

### Task 1: Enhance School Card Component (AC: 1-4)

- [x] Edit or create `frontend/src/components/schools/SchoolCard.tsx`:

```typescript
import { Card, CardContent, CardFooter, CardHeader } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Building2, Users, GraduationCap, BookOpen } from "lucide-react"

interface SchoolCardProps {
  school: {
    id: string
    name: string
    address?: string
    teacher_count: number
    student_count: number
    book_count: number
  }
  onEdit?: () => void
  onViewDetails?: () => void
}

export function SchoolCard({ school, onEdit, onViewDetails }: SchoolCardProps) {
  return (
    <Card className="hover:shadow-md transition-shadow">
      <CardHeader className="pb-2">
        <div className="flex items-center gap-3">
          <div className="p-2 bg-primary/10 rounded-lg">
            <Building2 className="h-5 w-5 text-primary" />
          </div>
          <div className="flex-1 min-w-0">
            <h3 className="font-semibold truncate">{school.name}</h3>
            {school.address && (
              <p className="text-sm text-muted-foreground truncate">
                {school.address}
              </p>
            )}
          </div>
        </div>
      </CardHeader>
      <CardContent>
        <div className="grid grid-cols-3 gap-2 text-center">
          <div className="p-2 bg-muted rounded-md">
            <Users className="h-4 w-4 mx-auto mb-1 text-muted-foreground" />
            <p className="text-lg font-semibold">{school.teacher_count}</p>
            <p className="text-xs text-muted-foreground">Teachers</p>
          </div>
          <div className="p-2 bg-muted rounded-md">
            <GraduationCap className="h-4 w-4 mx-auto mb-1 text-muted-foreground" />
            <p className="text-lg font-semibold">{school.student_count}</p>
            <p className="text-xs text-muted-foreground">Students</p>
          </div>
          <div className="p-2 bg-muted rounded-md">
            <BookOpen className="h-4 w-4 mx-auto mb-1 text-muted-foreground" />
            <p className="text-lg font-semibold">{school.book_count}</p>
            <p className="text-xs text-muted-foreground">Books</p>
          </div>
        </div>
      </CardContent>
      <CardFooter className="gap-2">
        {onViewDetails && (
          <Button variant="outline" size="sm" onClick={onViewDetails}>
            View Details
          </Button>
        )}
        {onEdit && (
          <Button variant="ghost" size="sm" onClick={onEdit}>
            Edit
          </Button>
        )}
      </CardFooter>
    </Card>
  )
}
```

### Task 2: Create School List View Component (AC: 5-7)

- [x] Create `frontend/src/components/schools/SchoolListView.tsx`:

```typescript
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table"
import { Button } from "@/components/ui/button"

interface SchoolListViewProps {
  schools: School[]
  onEdit?: (school: School) => void
  onViewDetails?: (school: School) => void
}

export function SchoolListView({ schools, onEdit, onViewDetails }: SchoolListViewProps) {
  return (
    <Table>
      <TableHeader>
        <TableRow>
          <TableHead>Name</TableHead>
          <TableHead>Address</TableHead>
          <TableHead className="text-center">Teachers</TableHead>
          <TableHead className="text-center">Students</TableHead>
          <TableHead className="text-center">Books</TableHead>
          <TableHead className="text-right">Actions</TableHead>
        </TableRow>
      </TableHeader>
      <TableBody>
        {schools.map((school) => (
          <TableRow key={school.id}>
            <TableCell className="font-medium">{school.name}</TableCell>
            <TableCell className="text-muted-foreground">
              {school.address || "-"}
            </TableCell>
            <TableCell className="text-center">{school.teacher_count}</TableCell>
            <TableCell className="text-center">{school.student_count}</TableCell>
            <TableCell className="text-center">{school.book_count}</TableCell>
            <TableCell className="text-right space-x-2">
              {onViewDetails && (
                <Button variant="ghost" size="sm" onClick={() => onViewDetails(school)}>
                  View
                </Button>
              )}
              {onEdit && (
                <Button variant="ghost" size="sm" onClick={() => onEdit(school)}>
                  Edit
                </Button>
              )}
            </TableCell>
          </TableRow>
        ))}
      </TableBody>
    </Table>
  )
}
```

### Task 3: Update Publisher Schools Page (AC: 5-7)

- [x] Edit `frontend/src/routes/_layout/publisher/schools.tsx`:
- [x] Add ViewModeToggle
- [x] Add useViewPreference hook
- [x] Conditional render grid or list

### Task 4: Enhance Teacher Card Component (AC: 8-11)

- [x] Edit or create `frontend/src/components/teachers/TeacherCard.tsx`:

```typescript
import { Card, CardContent, CardFooter, CardHeader } from "@/components/ui/card"
import { Avatar, AvatarFallback } from "@/components/ui/avatar"
import { Button } from "@/components/ui/button"
import { BookOpen, Building2, Users } from "lucide-react"

interface TeacherCardProps {
  teacher: {
    id: string
    full_name: string
    email: string
    school_name?: string
    books_assigned: number
    classroom_count: number
  }
  onEdit?: () => void
  onViewDetails?: () => void
}

export function TeacherCard({ teacher, onEdit, onViewDetails }: TeacherCardProps) {
  const initials = teacher.full_name
    .split(" ")
    .map((n) => n[0])
    .join("")
    .toUpperCase()
    .slice(0, 2)

  return (
    <Card className="hover:shadow-md transition-shadow">
      <CardHeader className="pb-2">
        <div className="flex items-center gap-3">
          <Avatar>
            <AvatarFallback>{initials}</AvatarFallback>
          </Avatar>
          <div className="flex-1 min-w-0">
            <h3 className="font-semibold truncate">{teacher.full_name}</h3>
            <p className="text-sm text-muted-foreground truncate">
              {teacher.email}
            </p>
          </div>
        </div>
      </CardHeader>
      <CardContent>
        <div className="space-y-2 text-sm">
          {teacher.school_name && (
            <div className="flex items-center gap-2 text-muted-foreground">
              <Building2 className="h-4 w-4" />
              <span className="truncate">{teacher.school_name}</span>
            </div>
          )}
          <div className="flex items-center gap-4">
            <div className="flex items-center gap-1 text-muted-foreground">
              <BookOpen className="h-4 w-4" />
              <span>{teacher.books_assigned} books</span>
            </div>
            <div className="flex items-center gap-1 text-muted-foreground">
              <Users className="h-4 w-4" />
              <span>{teacher.classroom_count} classes</span>
            </div>
          </div>
        </div>
      </CardContent>
      <CardFooter className="gap-2">
        {onViewDetails && (
          <Button variant="outline" size="sm" onClick={onViewDetails}>
            View Details
          </Button>
        )}
        {onEdit && (
          <Button variant="ghost" size="sm" onClick={onEdit}>
            Edit
          </Button>
        )}
      </CardFooter>
    </Card>
  )
}
```

### Task 5: Create Teacher List View Component (AC: 12-14)

- [x] Create `frontend/src/components/teachers/TeacherListView.tsx`:
- [x] Include sortable columns
- [x] Include all teacher info

### Task 6: Create Teacher Filters Component (AC: 15-18)

- [x] Create `frontend/src/components/teachers/TeacherFilters.tsx`:

```typescript
interface TeacherFiltersProps {
  filters: {
    search: string
    school: string
  }
  onChange: (filters: TeacherFilters) => void
  schools: { id: string; name: string }[]
}

export function TeacherFilters({ filters, onChange, schools }: TeacherFiltersProps) {
  return (
    <div className="flex flex-wrap items-center gap-3 mb-4">
      <div className="relative flex-1 min-w-[200px] max-w-[300px]">
        <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4" />
        <Input
          placeholder="Search teachers..."
          value={filters.search}
          onChange={(e) => onChange({ ...filters, search: e.target.value })}
          className="pl-9"
        />
      </div>

      <Select
        value={filters.school}
        onValueChange={(v) => onChange({ ...filters, school: v === "all" ? "" : v })}
      >
        <SelectTrigger className="w-[180px]">
          <SelectValue placeholder="All Schools" />
        </SelectTrigger>
        <SelectContent>
          <SelectItem value="all">All Schools</SelectItem>
          {schools.map((school) => (
            <SelectItem key={school.id} value={school.id}>
              {school.name}
            </SelectItem>
          ))}
        </SelectContent>
      </Select>

      {(filters.search || filters.school) && (
        <Button variant="ghost" size="sm" onClick={() => onChange({ search: "", school: "" })}>
          Clear
        </Button>
      )}
    </div>
  )
}
```

### Task 7: Update Publisher Teachers Page (AC: 12-18)

- [x] Edit `frontend/src/routes/_layout/publisher/teachers.tsx`:
- [x] Add ViewModeToggle
- [x] Add TeacherFilters
- [x] Add useViewPreference hook
- [x] Conditional render grid or list

### Task 8: Update API to Include Counts (AC: 1-4, 8-10)

- [x] Verify backend returns counts with school data:
  - `teacher_count`
  - `student_count`
  - `book_count` (assignments)
- [x] Verify backend returns counts with teacher data:
  - `books_assigned`
  - `classroom_count`
- [x] If not available, add to API response

### Task 9: Write Component Tests

- [x] Test SchoolCard renders all counts
- [x] Test TeacherCard renders all info
- [x] Test view toggle persistence
- [x] Test filter functionality

---

## Technical Notes

### Files to Create

| File | Description |
|------|-------------|
| `frontend/src/components/schools/SchoolCard.tsx` | Enhanced school card |
| `frontend/src/components/schools/SchoolListView.tsx` | School list view |
| `frontend/src/components/teachers/TeacherCard.tsx` | Enhanced teacher card |
| `frontend/src/components/teachers/TeacherListView.tsx` | Teacher list view |
| `frontend/src/components/teachers/TeacherFilters.tsx` | Teacher filters |

### Files to Modify

| File | Changes |
|------|---------|
| `frontend/src/routes/_layout/publisher/schools.tsx` | Add toggle, use new components |
| `frontend/src/routes/_layout/publisher/teachers.tsx` | Add toggle, filters, use new components |

### Backend Data Requirements

Schools need:
```typescript
interface SchoolWithCounts {
  id: string
  name: string
  address?: string
  teacher_count: number
  student_count: number
  book_count: number  // books assigned via teachers
}
```

Teachers need:
```typescript
interface TeacherWithCounts {
  id: string
  full_name: string
  email: string
  school_name: string
  books_assigned: number
  classroom_count: number
}
```

If backend doesn't provide these counts, they can be:
1. Added to backend response (preferred)
2. Computed on frontend from related queries (less efficient)

---

## Dependencies

- Story 19.2 (View Toggle Component) - reuse ViewModeToggle
- Backend API may need enhancement for counts

---

## Estimation

- **Complexity:** Medium
- **Components:** 5 new components, 2 files modified
- **Backend:** Possibly needs count fields added

---

## Definition of Done

- [ ] School cards show teacher/student/book counts
- [ ] School list view available with toggle
- [ ] Teacher cards show books/school/classes
- [ ] Teacher list view available with toggle
- [ ] Teacher filters by school and search work
- [ ] View preferences persist
- [ ] All tests pass

---

## Test Scenarios

| Scenario | Expected Result |
|----------|-----------------|
| View Schools in grid mode | Cards show all counts |
| Switch Schools to list mode | Table with all data |
| View Teachers in grid mode | Cards show books, school, classes |
| Filter teachers by school | Only that school's teachers shown |
| Search teachers by name | Matching teachers shown |
| Refresh page | View mode persisted |

---

## Dev Agent Record

### Agent Model Used
- [x] Claude Sonnet 4.5 (claude-sonnet-4-5-20250929) - 2025-12-24

### Tasks
_Checkboxes updated during implementation_

### Debug Log References
_Add links to debug log entries if issues arise_

### Completion Notes

**Implementation Summary:**
- Created new SchoolCard and TeacherCard components with enhanced count displays
- Implemented list views for both schools and teachers with table layout
- Added view mode toggle functionality with localStorage persistence
- Implemented teacher filtering by school and search
- Extended backend API to return aggregated counts (teacher_count, student_count, book_count, books_assigned, classroom_count, school_name)
- Added component tests for new components
- Backend tests pass (16/16 publisher endpoint tests)

**Technical Decisions:**
- Used server-side aggregation for counts to avoid multiple client-side queries
- Implemented sortable columns in teacher list view for better usability
- Added filtering logic in frontend using useMemo for performance
- Reused existing ViewModeToggle and useViewPreference from Story 19.2

### File List
**Created:**
- `frontend/src/components/schools/SchoolCard.tsx`
- `frontend/src/components/schools/SchoolListView.tsx`
- `frontend/src/components/teachers/TeacherCard.tsx`
- `frontend/src/components/teachers/TeacherListView.tsx`
- `frontend/src/components/teachers/TeacherFilters.tsx`
- `frontend/src/components/schools/__tests__/SchoolCard.test.tsx`
- `frontend/src/components/teachers/__tests__/TeacherCard.test.tsx`
- `frontend/src/components/teachers/__tests__/TeacherFilters.test.tsx`

**Modified:**
- `frontend/src/routes/_layout/publisher/schools.tsx`
- `frontend/src/routes/_layout/publisher/teachers.tsx`
- `backend/app/schemas/publisher.py`
- `backend/app/api/routes/publishers.py`

### Change Log
| Date | Change | Author |
|------|--------|--------|
| 2025-12-20 | Story created | John (PM) |
| 2025-12-24 | Story implemented | James (Dev Agent) |
