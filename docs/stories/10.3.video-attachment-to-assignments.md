# Story 10.3: Video Attachment to Assignments

**Status:** Not Started
**Epic:** Epic 10 - Audio & Video Media Integration
**Story Points:** 5
**Priority:** Medium
**Dependencies:** Story 10.1 (Backend Streaming Media Proxy) - DONE

---

## User Story

As a **teacher**,
I want **to attach a video from the book to an assignment**,
So that **students can watch instructional content alongside their activities**.

---

## Acceptance Criteria

### Teacher Experience
1. [ ] Video picker displayed in assignment creation dialog (Step 3: Configure Settings)
2. [ ] Video picker shows available videos from selected book's DCS folder
3. [ ] Teacher can preview video before attaching
4. [ ] Video attachment is optional (assignments work without video)
5. [ ] Attached video shown in assignment review step
6. [ ] Video can be removed before creating assignment
7. [ ] Edit assignment dialog shows attached video (read-only)

### Student Experience
8. [ ] Video player appears alongside activity when assignment has video attached
9. [ ] Video player supports: play, pause, seek, fullscreen
10. [ ] Video player supports playback speed control (0.5x, 0.75x, 1x, 1.25x, 1.5x, 2x)
11. [ ] Video player supports subtitle display (.srt files from DCS)
12. [ ] Video does NOT auto-play (student must click to start)
13. [ ] Student can minimize/collapse video player
14. [ ] Video remains accessible throughout all activities in multi-activity assignments

### Technical Requirements
15. [ ] Database migration adds `video_path` field to Assignment model
16. [ ] API endpoint to list available videos for a book
17. [ ] Video streaming uses existing `/api/v1/books/{book_id}/media/{path}` endpoint
18. [ ] Subtitle files loaded from same path with `.srt` extension
19. [ ] Proper error handling if video/subtitles fail to load
20. [ ] Unit tests for video picker and player components
21. [ ] Integration tests for video attachment flow

---

## UI Design

### Teacher: Assignment Creation - Video Selection

```
Step 3: Configure Settings
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Assignment Name *                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Chapter 1 Review                                           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚ Instructions                                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Watch the video and complete the activities...             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚ Attach Video (Optional)                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [â–¼ Select a video from this book...]                       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚ â”‚  ðŸ“¹ intro.mp4                              [Preview] â”‚      â”‚
â”‚ â”‚  ðŸ“¹ chapter1_explanation.mp4               [Preview] â”‚      â”‚
â”‚ â”‚  ðŸ“¹ pronunciation_guide.mp4                [Preview] â”‚      â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                â”‚
â”‚ Due Date                        Time Limit                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚ â”‚ ðŸ“… Dec 15, 2025     â”‚        â”‚ 30 minutes          â”‚        â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Teacher: Video Preview Modal

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Preview: chapter1_explanation.mp4                         [Ã—]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                                                            â”‚ â”‚
â”‚ â”‚                    [VIDEO PLAYER]                          â”‚ â”‚
â”‚ â”‚                                                            â”‚ â”‚
â”‚ â”‚  â–¶ï¸  â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â—â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬  1:23 / 5:45   ðŸ”Š  â›¶           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              [Cancel]  [Attach This Video]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Teacher: Review Step with Video

```
Step 4: Review & Create
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Review Your Assignment                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Book: Switch to CLIL                                           â”‚
â”‚ Activities: 3 activities                                       â”‚
â”‚ Recipients: Class 5A (24 students)                             â”‚
â”‚                                                                â”‚
â”‚ â”Œâ”€ Attached Video â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ ðŸ“¹ chapter1_explanation.mp4 (5:45)              [Remove] â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚ Name: Chapter 1 Review                                         â”‚
â”‚ Due: Dec 15, 2025 at 11:59 PM                                  â”‚
â”‚ Time Limit: 30 minutes                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Student: Activity with Video Player

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Chapter 1 Review                           Activity 1 of 3    â± 28:45  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  â”Œâ”€ Video â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚ â”‚                                                              â”‚ â”‚ â”‚
â”‚  â”‚ â”‚                     [VIDEO CONTENT]                          â”‚ â”‚ â”‚
â”‚  â”‚ â”‚                                                              â”‚ â”‚ â”‚
â”‚  â”‚ â”‚  Subtitles: "The capital city is very old..."                â”‚ â”‚ â”‚
â”‚  â”‚ â”‚                                                              â”‚ â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚ â–¶ï¸  â–¬â–¬â–¬â–¬â—â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬  1:23/5:45  [1xâ–¼]  ðŸ”Šâ”â”â”  [CC]  â›¶   [âˆ’]   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€ Activity â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚  Fill in the Blanks: The ___ city is very ___.                   â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚  Word Bank: [capital] [old] [nice] [new]                         â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Save & Exit]                              [â† Prev] [Next â†’] [Submit] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Student: Minimized Video Player

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Chapter 1 Review                           Activity 1 of 3    â± 28:45  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€ Video (minimized) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚ â”‚ ðŸ“¹ chapter1_explanation.mp4  â–¶ï¸ 1:23/5:45         [+]   â”‚           â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€ Activity â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚  Fill in the Blanks: The ___ city is very ___.                   â”‚ â”‚
â”‚  â”‚  ...                                                             â”‚ â”‚
```

---

## Technical Architecture

### Database Changes

```python
# backend/app/models.py

class Assignment(SQLModel, table=True):
    # ... existing fields ...

    # Story 10.3: Video attachment
    video_path: str | None = Field(default=None, max_length=500)
    # Stores relative path like "videos/chapter1.mp4"
    # Full URL constructed as /api/v1/books/{book_id}/media/{video_path}
```

### API Endpoints

#### New: List Available Videos for Book

```python
# backend/app/api/routes/books.py

@router.get("/{book_id}/videos")
async def list_book_videos(
    book_id: uuid.UUID,
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db),
) -> list[VideoInfo]:
    """
    List available videos in a book's DCS folder.

    Returns:
        List of VideoInfo objects with path, name, duration (if available)
    """
```

**Response Schema:**

```python
class VideoInfo(BaseModel):
    path: str           # "videos/chapter1.mp4"
    name: str           # "chapter1.mp4"
    size_bytes: int     # File size
    has_subtitles: bool # True if .srt file exists
```

#### Modified: Assignment Create/Update

```python
# backend/app/schemas/assignment.py

class AssignmentCreate(BaseModel):
    # ... existing fields ...
    video_path: str | None = None  # NEW: Optional video attachment

class AssignmentUpdate(BaseModel):
    # ... existing fields ...
    video_path: str | None = None  # NEW: Can update video
```

### Frontend Components

#### New: VideoPlayer Component

**File:** `frontend/src/components/ActivityPlayers/VideoPlayer.tsx`

```typescript
interface VideoPlayerProps {
  /** URL to the video file */
  src: string
  /** URL to subtitle file (.srt) - optional */
  subtitleSrc?: string
  /** Whether player is expanded */
  isExpanded?: boolean
  /** Callback when minimize clicked */
  onMinimize?: () => void
  /** Callback when expand clicked */
  onExpand?: () => void
  /** Additional CSS classes */
  className?: string
}
```

**Features:**
- HTML5 `<video>` element with controls
- Custom controls overlay for consistent styling
- Play/Pause toggle
- Progress bar with seeking (uses Range requests)
- Current time / Duration display
- Playback speed selector (0.5x - 2x)
- Volume control with mute
- Subtitle toggle (CC button)
- Fullscreen toggle
- Minimize/Expand toggle
- Loading state
- Error handling with retry

#### New: VideoPicker Component

**File:** `frontend/src/components/assignments/VideoPicker.tsx`

```typescript
interface VideoPickerProps {
  bookId: string
  selectedVideo: string | null
  onSelect: (videoPath: string | null) => void
}
```

**Features:**
- Dropdown/combobox to select video
- Shows video name and duration
- Preview button opens modal with video player
- Clear selection option

#### New: VideoPreviewModal Component

**File:** `frontend/src/components/assignments/VideoPreviewModal.tsx`

```typescript
interface VideoPreviewModalProps {
  bookId: string
  videoPath: string
  isOpen: boolean
  onClose: () => void
  onAttach: () => void
}
```

#### Modified: StepConfigureSettings

**File:** `frontend/src/components/assignments/steps/StepConfigureSettings.tsx`

Add VideoPicker below Instructions field.

#### Modified: MultiActivityPlayer

**File:** `frontend/src/components/ActivityPlayers/MultiActivityPlayer.tsx`

Add VideoPlayer section above activity content when assignment has video.

---

## Tasks & Subtasks

### Task 1: Database Migration

**Status:** Not Started
**Estimated effort:** 30 minutes

**Subtasks:**
1. [ ] Create Alembic migration to add `video_path` column to `assignment` table
2. [ ] Column should be nullable VARCHAR(500)
3. [ ] Run migration and verify

**File:** `backend/app/alembic/versions/xxxxx_add_video_path_to_assignment.py`

---

### Task 2: Backend API - List Book Videos

**Status:** Not Started
**Estimated effort:** 2 hours

**Subtasks:**
1. [ ] Add `VideoInfo` schema to `backend/app/schemas/book.py`
2. [ ] Add `list_videos()` method to `DreamStorageClient`
3. [ ] Create `GET /api/v1/books/{book_id}/videos` endpoint
4. [ ] Check for corresponding `.srt` subtitle files
5. [ ] Add unit tests for endpoint
6. [ ] Add integration tests with DCS

**Implementation Notes:**
- Query DCS for files in `videos/` folder
- Filter by video extensions (.mp4, .webm)
- Check if `{video_name}.srt` exists for subtitle detection

---

### Task 3: Backend API - Assignment Video Field

**Status:** Not Started
**Estimated effort:** 1 hour

**Subtasks:**
1. [ ] Add `video_path` field to `AssignmentCreate` schema
2. [ ] Add `video_path` field to `AssignmentUpdate` schema
3. [ ] Add `video_path` field to `AssignmentResponse` schema
4. [ ] Update assignment create endpoint to save video_path
5. [ ] Update assignment update endpoint to allow video_path changes
6. [ ] Validate video_path exists in DCS before saving
7. [ ] Add unit tests

---

### Task 4: Frontend - VideoPlayer Component

**Status:** Not Started
**Estimated effort:** 3 hours

**Subtasks:**
1. [ ] Create `VideoPlayer.tsx` component
2. [ ] Implement HTML5 video element with custom controls
3. [ ] Add play/pause functionality
4. [ ] Add progress bar with seek support
5. [ ] Add time display (current/duration)
6. [ ] Add playback speed control dropdown
7. [ ] Add volume control with mute toggle
8. [ ] Add fullscreen toggle
9. [ ] Add minimize/expand functionality
10. [ ] Add loading state with spinner
11. [ ] Add error state with retry button
12. [ ] Style to match existing UI (teal accent color)
13. [ ] Add unit tests

**Reference:** Follow patterns from `AudioPlayer.tsx`

---

### Task 5: Frontend - Subtitle Support

**Status:** Not Started
**Estimated effort:** 1.5 hours

**Subtasks:**
1. [ ] Parse SRT subtitle format
2. [ ] Create subtitle display overlay
3. [ ] Add CC toggle button to video controls
4. [ ] Sync subtitles with video playback time
5. [ ] Style subtitles (white text, semi-transparent black background)
6. [ ] Add unit tests for SRT parsing

**SRT Format Example:**
```
1
00:00:01,000 --> 00:00:04,000
The capital city is very old.

2
00:00:04,500 --> 00:00:08,000
It has many beautiful buildings.
```

---

### Task 6: Frontend - VideoPicker Component

**Status:** Not Started
**Estimated effort:** 2 hours

**Subtasks:**
1. [ ] Create `VideoPicker.tsx` component
2. [ ] Fetch videos list from `/api/v1/books/{bookId}/videos`
3. [ ] Display as Select/Combobox dropdown
4. [ ] Show video name and subtitle indicator
5. [ ] Add "Preview" button for each video
6. [ ] Add "Clear selection" option
7. [ ] Handle loading and error states
8. [ ] Add unit tests

---

### Task 7: Frontend - VideoPreviewModal

**Status:** Not Started
**Estimated effort:** 1 hour

**Subtasks:**
1. [ ] Create `VideoPreviewModal.tsx` component
2. [ ] Use Dialog component from shadcn/ui
3. [ ] Embed VideoPlayer inside modal
4. [ ] Add "Cancel" and "Attach This Video" buttons
5. [ ] Add unit tests

---

### Task 8: Frontend - Assignment Creation Integration

**Status:** Not Started
**Estimated effort:** 1.5 hours

**Subtasks:**
1. [ ] Add `video_path` to `AssignmentFormData` interface
2. [ ] Add VideoPicker to `StepConfigureSettings.tsx`
3. [ ] Pass video_path in API request
4. [ ] Display attached video in review step
5. [ ] Add "Remove" button in review step
6. [ ] Update TypeScript types

---

### Task 9: Frontend - Student Activity Integration

**Status:** Not Started
**Estimated effort:** 2 hours

**Subtasks:**
1. [ ] Modify `MultiActivityPlayer.tsx` to accept video props
2. [ ] Add VideoPlayer section above activity content
3. [ ] Fetch video URL from assignment data
4. [ ] Handle minimize/expand state
5. [ ] Persist video player state across activity navigation
6. [ ] Video continues playing when switching activities
7. [ ] Add unit tests

---

### Task 10: End-to-End Testing

**Status:** Not Started
**Estimated effort:** 1.5 hours

**Subtasks:**
1. [ ] Test teacher creates assignment with video
2. [ ] Test teacher previews video before attaching
3. [ ] Test teacher removes video before creating
4. [ ] Test student sees video in assignment
5. [ ] Test video playback (play, pause, seek)
6. [ ] Test playback speed control
7. [ ] Test subtitle display
8. [ ] Test fullscreen mode
9. [ ] Test minimize/expand
10. [ ] Test video persists across activity navigation
11. [ ] Test error handling (missing video, network error)

---

## Dev Notes

### Video Storage in DCS

Videos are stored in Dream Central Storage at:
```
{publisher}/{book_name}/{version}/{book_name}/videos/
```

**Examples:**
- `Universal ELT/SwitchtoCLIL/v1/SwitchtoCLIL/videos/intro.mp4`
- `Universal ELT/SwitchtoCLIL/v1/SwitchtoCLIL/videos/intro.srt`

### URL Construction

```typescript
// Frontend utility
function getVideoUrl(bookId: string, videoPath: string): string {
  return `/api/v1/books/${bookId}/media/${videoPath}`;
}

function getSubtitleUrl(bookId: string, videoPath: string): string {
  const srtPath = videoPath.replace(/\.[^.]+$/, '.srt');
  return `/api/v1/books/${bookId}/media/${srtPath}`;
}
```

### HTML5 Video with Subtitles

```html
<video>
  <source src="/api/v1/books/{bookId}/media/videos/intro.mp4" type="video/mp4" />
  <track
    kind="subtitles"
    src="/api/v1/books/{bookId}/media/videos/intro.srt"
    srclang="en"
    label="English"
    default
  />
</video>
```

**Note:** HTML5 `<track>` element expects WebVTT format. Since DCS has SRT files, we need to either:
1. Convert SRT to VTT on the fly (backend)
2. Parse SRT in JavaScript and render custom subtitle overlay (frontend)

Recommendation: Option 2 (frontend parsing) for simplicity.

### Responsive Considerations

- Video player should be max 50% height on desktop
- Full width on tablet/mobile
- Minimize option important for smaller screens
- Consider picture-in-picture for modern browsers

---

## Definition of Done

- [ ] Database migration applied successfully
- [ ] Videos list endpoint returns available videos
- [ ] Assignment can be created with video attachment
- [ ] Assignment can be updated to add/remove video
- [ ] Teacher can preview videos before attaching
- [ ] Student sees video player alongside activity
- [ ] Video playback works (play, pause, seek)
- [ ] Playback speed control works
- [ ] Subtitles display correctly (when available)
- [ ] Fullscreen mode works
- [ ] Minimize/expand works
- [ ] Video persists across multi-activity navigation
- [ ] Error handling shows appropriate messages
- [ ] Unit tests passing (>80% coverage)
- [ ] Integration tests passing
- [ ] Works on Chrome, Firefox, Safari
- [ ] Responsive on desktop and tablet
- [ ] No console errors during playback

---

## Testing Checklist

### Teacher Flow

- [ ] Open assignment creation dialog
- [ ] Reach Step 3 (Configure Settings)
- [ ] See video picker dropdown
- [ ] Click dropdown â†’ see list of videos from book
- [ ] Click "Preview" â†’ modal opens with video player
- [ ] Play video in preview modal
- [ ] Click "Attach This Video" â†’ modal closes, video selected
- [ ] Continue to Step 4 (Review)
- [ ] See attached video in review summary
- [ ] Click "Remove" â†’ video removed
- [ ] Re-attach video
- [ ] Create assignment
- [ ] Verify assignment saved with video_path

### Student Flow

- [ ] Open assignment with attached video
- [ ] See video player above activity
- [ ] Click play â†’ video starts
- [ ] Click pause â†’ video pauses
- [ ] Click progress bar â†’ video seeks
- [ ] Change playback speed â†’ speed changes
- [ ] Toggle CC â†’ subtitles appear/disappear
- [ ] Click fullscreen â†’ video goes fullscreen
- [ ] Exit fullscreen â†’ returns to normal
- [ ] Click minimize â†’ video collapses to bar
- [ ] Click expand â†’ video expands
- [ ] Navigate to next activity â†’ video still visible
- [ ] Complete assignment â†’ video player closes

### Error Scenarios

- [ ] Book with no videos â†’ picker shows "No videos available"
- [ ] Video file missing from DCS â†’ error state with retry
- [ ] Subtitle file missing â†’ no CC button shown
- [ ] Network error during playback â†’ error state
- [ ] Invalid video format â†’ error state

---

## Risk Assessment

| Risk | Impact | Likelihood | Mitigation |
|------|--------|------------|------------|
| Large video files cause slow loading | Medium | Medium | Use Range requests (already implemented), show loading progress |
| DCS video listing slow | Low | Low | Cache video list in frontend, add loading state |
| Subtitle sync issues | Medium | Low | Test with various SRT files, add manual offset control if needed |
| Mobile video autoplay blocked | Medium | High | Already handled - require user click to play |
| Safari video quirks | Medium | Medium | Test early, use standard HTML5 patterns |

---

## Success Metrics

| Metric | Target |
|--------|--------|
| Video load time (first byte) | < 1 second |
| Seek response time | < 300ms |
| Subtitle sync accuracy | < 100ms drift |
| Teacher video attachment rate | Track adoption |
| Student video completion rate | Track engagement |

---

## Related Documentation

- [Epic 10: Audio & Video Media Integration](../prd/epic-10-audio-video-media-integration.md)
- [Story 10.1: Backend Streaming Media Proxy](./10.1.backend-streaming-media-proxy.md)
- [Story 10.2: Frontend Audio Player Component](./10.2.frontend-audio-player-component.md)
- [Dream Central Storage Integration](../dream-central-storage-integration.md)

---

## QA Results

### Review Date: 2025-12-08

### Reviewed By: Quinn (Test Architect)

### Implementation Summary

The implementation **exceeds the original story requirements** by implementing a more flexible "Additional Resources" system instead of a single video attachment. This allows multiple videos to be attached to assignments with per-video subtitle controls, providing better extensibility for future resource types.

**Key deviations from original spec (improvements):**
- Instead of a single `video_path` field, implemented `resources: AdditionalResources` supporting multiple videos
- Added `ResourceSidebar` component with collapsible sidebar UI (pushes content, doesn't overlay)
- Video resources stored with subtitle enable/disable control per video
- Video player modal opens from sidebar rather than embedded inline
- Teacher configuration happens in a new "Additional Resources" wizard step rather than Settings step

### Code Quality Assessment

**Overall: GOOD** - Well-structured implementation with proper TypeScript typing, component composition, and separation of concerns.

**Strengths:**
1. **VideoPlayer.tsx** (769 lines): Full-featured player with all required functionality:
   - Play/pause, seeking, time display âœ“
   - Playback speed control (0.5x-2x) âœ“
   - Volume control with mute âœ“
   - Fullscreen toggle âœ“
   - Subtitle support with SRT parsing âœ“
   - Minimize/expand functionality âœ“
   - Loading/error states with retry âœ“
   - Auto-hide controls during playback âœ“
   - Accessible with ARIA labels âœ“

2. **videoUtils.ts** (186 lines): Robust subtitle parsing:
   - SRT and VTT format support
   - Handles edge cases (CRLF, hours, malformed entries)
   - Well-tested with 22 unit tests

3. **ResourceSidebar.tsx** (217 lines): Clean sidebar implementation:
   - Pushes content instead of overlaying
   - Video modal for playback
   - Resource count badge
   - Subtitle indicator per video

4. **Type Safety**: Proper interfaces for `VideoResource`, `AdditionalResources`, integration with assignment types

**Areas for Improvement:**
1. No unit tests for `VideoPlayer.tsx` component (AC 20)
2. No unit tests for `ResourceSidebar.tsx` component
3. No integration tests for video attachment flow (AC 21)
4. Story status not updated to reflect implementation progress

### Refactoring Performed

None - code quality is acceptable.

### Compliance Check

- Coding Standards: âœ“ Follows project patterns (hooks, component composition, TypeScript)
- Project Structure: âœ“ Files in correct locations under `components/ActivityPlayers/`
- Testing Strategy: âœ— Missing component tests for VideoPlayer and ResourceSidebar
- All ACs Met: Partial - See detailed analysis below

### Acceptance Criteria Analysis

**Teacher Experience:**
- [âœ“] AC1: Video picker in assignment creation (implemented as "Additional Resources" step)
- [âœ“] AC2: Video picker shows available videos (via resources API)
- [âœ“] AC3: Teacher can preview video (modal with VideoPlayer)
- [âœ“] AC4: Video attachment optional
- [âœ“] AC5: Attached video shown in review step
- [âœ“] AC6: Video can be removed before creating
- [âœ“] AC7: Edit dialog shows attached video

**Student Experience:**
- [âœ“] AC8: Video player appears alongside activity (via ResourceSidebar)
- [âœ“] AC9: Play, pause, seek, fullscreen
- [âœ“] AC10: Playback speed control (0.5x-2x)
- [âœ“] AC11: Subtitle display support
- [âœ“] AC12: No auto-play
- [âœ“] AC13: Minimize/collapse (implemented as sidebar toggle)
- [âœ“] AC14: Video accessible throughout multi-activity (persists via state)

**Technical Requirements:**
- [âœ“] AC15: Database migration (video_path and resources fields added)
- [~] AC16: API endpoint for videos (using existing media proxy, no dedicated list endpoint)
- [âœ“] AC17: Video streaming via existing endpoint
- [âœ“] AC18: Subtitle loading via same path pattern
- [âœ“] AC19: Error handling implemented
- [âœ—] AC20: Missing unit tests for VideoPlayer component
- [âœ—] AC21: Missing integration tests for video attachment flow

### Improvements Checklist

- [x] VideoPlayer component with full functionality
- [x] Subtitle parsing (SRT/VTT) with unit tests (22 tests passing)
- [x] ResourceSidebar for multi-video support
- [x] Database schema for resources field
- [x] Backend API integration
- [x] Type definitions for VideoResource, AdditionalResources
- [ ] Add unit tests for VideoPlayer component
- [ ] Add unit tests for ResourceSidebar component
- [ ] Add integration/E2E tests for video attachment flow
- [ ] Update story status from "Not Started" to reflect actual progress

### Security Review

- âœ“ Video URLs constructed server-side via existing authenticated media proxy
- âœ“ No direct DCS access from frontend
- âœ“ Subtitle files loaded through same authenticated endpoint
- No security concerns identified

### Performance Considerations

- âœ“ Video uses HTML5 `<video>` element with native streaming
- âœ“ Subtitles loaded on-demand only when subtitle toggle enabled
- âœ“ ResizeObserver used for responsive layout updates
- âœ“ Video continues playing during activity navigation (state preserved)
- Consider: Could add video preloading hints for better UX

### Files Modified During Review

None - review only.

### Test Coverage

| Component | Unit Tests | Integration Tests |
|-----------|------------|-------------------|
| videoUtils.ts | âœ“ 22 tests | - |
| VideoPlayer.tsx | âœ— Missing | - |
| ResourceSidebar.tsx | âœ— Missing | - |
| Video attachment flow | - | âœ— Missing |

### Gate Status

Gate: **CONCERNS** â†’ docs/qa/gates/10.3-video-attachment-to-assignments.yml

**Reason:** Implementation is functionally complete and exceeds original requirements, but missing required test coverage per AC20 and AC21. The video utils have excellent test coverage (22 tests), but VideoPlayer and ResourceSidebar components lack unit tests.

### Recommended Status

**âœ— Changes Required** - Add unit tests for VideoPlayer and ResourceSidebar components before marking as Done.

**Note:** Story status should be updated from "Not Started" to "Review" to reflect actual implementation state. The implementation is production-ready from a functionality standpoint but needs test coverage to meet the Definition of Done.
