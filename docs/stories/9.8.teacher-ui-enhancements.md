# Story 9.8: Teacher UI Enhancements

**Epic:** 9 - UX Improvements & Polish
**Story ID:** 9.8
**Status:** Done
**Created:** 2025-12-03
**Priority:** Medium

---

## Story

**As a** Teacher,
**I want** improved book and activity viewing with better visuals and editing capabilities,
**so that** I can more easily navigate content and modify my assignments.

---

## Acceptance Criteria

### Book Cover in Activity View
1. When viewing activities for a book, book cover is prominently displayed at top
2. Cover shown alongside book title and metadata
3. Provides context for which book's content is being viewed
4. Cover is appropriately sized (not too large, not too small)

### Library List View
5. Library/Books page has view toggle: Grid | List
6. Grid view is current default (book covers as cards)
7. List view shows books in table/list format with:
   - Cover thumbnail (small)
   - Title
   - Author
   - Grade level
   - Activity count
   - Last accessed date
8. List view allows sorting by columns
9. View preference persists (localStorage)

### Book Covers in Assignment Creation
10. When creating assignment and selecting book, book cover is visible
11. Book selector dropdown/picker shows covers alongside titles
12. Selected book displays cover in dialog header area
13. Helps teacher confirm they selected the correct book

### Page Zoom
14. When viewing book pages (to see activities), zoom controls available
15. Zoom in button (+) increases page size
16. Zoom out button (-) decreases page size
17. Reset/fit button returns to default size
18. Zoom level persists during session
19. Pages remain sharp/readable when zoomed (use high-res images or vector)
20. Keyboard shortcuts: Ctrl/Cmd + / -

### Edit Assignment Activities
21. When editing an existing assignment, teacher can modify activity selections
22. Edit dialog shows currently selected activities
23. Teacher can add more activities using same selection methods (tabs from 9.5)
24. Teacher can remove activities from assignment
25. Order can be changed (drag and drop or up/down arrows)
26. Save updates the assignment with new activity list
27. Warning if removing activities that students have already completed

---

## Tasks / Subtasks

### Frontend Tasks - Book Cover Display

- [x] **Task 1: Add Book Cover to Activity View** (AC: 1, 2, 3, 4)
  - [x] Locate activity view/browser page for teachers
  - [x] Add header section with book cover image
  - [x] Display: cover (120px height), title, author, grade
  - [x] Ensure cover loads properly with fallback
  - [x] Responsive sizing on mobile

### Frontend Tasks - Library List View

- [x] **Task 2: Create View Toggle Component** (AC: 5, 9)
  - [x] Add toggle buttons: Grid icon | List icon
  - [x] Default to Grid view
  - [x] Save preference to localStorage
  - [x] Read preference on page load

- [x] **Task 3: Create Book List View** (AC: 7, 8)
  - [x] Create `BookListView.tsx` component
  - [x] Table layout with columns:
    - [x] Cover (40x60 thumbnail)
    - [x] Title (sortable)
    - [x] Publisher (sortable, Note: Author not available in BookPublic type)
    - [x] Activities count
  - [x] Implement sort functionality
  - [x] Row click navigates to book detail
  - [x] Hover state for rows

- [x] **Task 4: Integrate View Toggle with Library Page** (AC: 5, 6)
  - [x] Modify Library/Books page
  - [x] Conditionally render GridView or ListView based on toggle
  - [x] Ensure both views use same data source
  - [x] Smooth transition between views (optional)

### Frontend Tasks - Assignment Creation Book Covers

- [x] **Task 5: Enhance Book Selector with Covers** (AC: 10, 11)
  - [x] Locate book selector in assignment creation dialog
  - [x] Modify dropdown/select to show book covers
  - [x] Each option: [Cover Thumbnail] Book Title
  - [x] Searchable dropdown with cover thumbnails

- [x] **Task 6: Show Selected Book Cover in Dialog** (AC: 12, 13)
  - [x] Add book display area in assignment creation header
  - [x] When book is selected, show cover prominently
  - [x] Display: Cover, Title
  - [x] Clear visual confirmation of selection

### Frontend Tasks - Page Zoom

- [x] **Task 7: Create Zoom Controls Component** (AC: 14, 15, 16, 17)
  - [x] Create `ZoomControls.tsx` component
  - [x] Buttons: [âˆ’] [100%] [+]
  - [x] Zoom levels: 50%, 75%, 100%, 125%, 150%, 200%
  - [x] Display current zoom percentage
  - [x] Reset button returns to 100%

- [x] **Task 8: Implement Page Zoom Functionality** (AC: 18, 19, 20)
  - [x] Apply zoom transform to page container
  - [x] Use CSS transform: scale() for smooth zoom
  - [x] Ensure container is scrollable when zoomed
  - [x] Test image quality at various zoom levels
  - [x] Add keyboard shortcuts:
    - [x] Ctrl/Cmd + Plus: zoom in
    - [x] Ctrl/Cmd + Minus: zoom out
    - [x] Ctrl/Cmd + 0: reset zoom
  - [x] Store zoom level in session state

### Frontend Tasks - Edit Assignment Activities

- [x] **Task 9: Create Edit Assignment Dialog** (AC: 21, 22, 23)
  - [x] Create edit dialog for assignments (`EditActivitiesDialog.tsx`)
  - [x] Load assignment data including activity IDs
  - [x] Pre-populate activity selection with current activities
  - [x] Show selected activities in summary panel
  - [x] Can add activities from same book

- [x] **Task 10: Implement Activity Removal** (AC: 24, 27)
  - [x] Add remove (X) button to each activity in selection
  - [x] Click removes activity from selection
  - [x] Warning alert about student progress impact displayed in dialog
  - [x] Must have at least one activity

- [x] **Task 11: Implement Activity Reordering** (AC: 25)
  - [x] Add drag handle icon to activity items
  - [x] Implemented up/down arrow buttons for reordering
  - [x] Update order in real-time
  - [x] Order reflected in final save

- [x] **Task 12: Save Assignment Changes** (AC: 26)
  - [x] Add "Save Changes" button
  - [x] Call PATCH endpoint with updated activity list
  - [x] Handle success: close dialog, refresh list, show toast
  - [x] Handle error: show message via toast

### Backend Tasks

- [x] **Task 13: Update Assignment PATCH Endpoint** (AC: 26, 27)
  - [x] Added `activity_ids` field to AssignmentUpdate schema
  - [x] Validate teacher owns the assignment (existing validation)
  - [x] Validate all activity_ids are from the same book
  - [x] Preserve existing submission data (only updates AssignmentActivity records)
  - [x] Return updated assignment

---

## UI Wireframes

### Library List View
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Library                                     [Grid] [List]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Cover    â”‚ Title â†‘         â”‚ Author    â”‚ Grade â”‚ Activities   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ğŸ“•]     â”‚ English Fun 1   â”‚ J. Smith  â”‚ 1     â”‚ 45           â”‚
â”‚ [ğŸ“—]     â”‚ English Fun 2   â”‚ J. Smith  â”‚ 2     â”‚ 52           â”‚
â”‚ [ğŸ“˜]     â”‚ Math Masters 3  â”‚ A. Jones  â”‚ 3     â”‚ 38           â”‚
â”‚ [ğŸ“™]     â”‚ Science World   â”‚ B. Lee    â”‚ 4     â”‚ 61           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Page Zoom Controls
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [âˆ’]  [100%]  [+]  [Reset]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Technical Notes

### Zoom Implementation
CSS transform is smoothest:
```css
.page-container {
  transform: scale(var(--zoom-level));
  transform-origin: top left;
}
```

Wrap in scrollable container that adjusts to scaled size.

### Activity Reordering
Use libraries like:
- `@dnd-kit/core` (recommended, modern)
- `react-beautiful-dnd`
- Simple up/down buttons if DnD is too complex

### Image Quality
Ensure page images are high enough resolution for 200% zoom. Consider lazy-loading at higher quality when zoomed.

---

## Dependencies

- Story 9.5 (Activity selection tabs - for edit dialog)
- Existing Library and assignment creation components

---

## Estimation

- **Complexity:** Medium
- **Components:** View toggle, list view, zoom controls, edit dialog enhancements

---

## QA Results

### Review Date: 2025-12-07

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

The implementation is well-structured with clear component separation. Key components were created:

1. **ZoomControls.tsx** - Clean implementation with keyboard shortcuts and proper state management. However, per conversation history, zoom functionality was removed from PageViewer per user feedback, making this component unused in current implementation.

2. **BookListView.tsx** - Good table implementation with sortable columns, authenticated image loading, and proper cleanup of blob URLs. Follows project patterns.

3. **EditActivitiesDialog.tsx** - Solid implementation supporting add/remove/reorder of activities with proper validation (minimum 1 activity) and user warnings about student progress impact.

4. **PageViewer.tsx** - Page viewing without zoom, using single/double page modes with proper aspect ratio handling.

5. **Backend (assignments.py)** - The PATCH endpoint properly handles `activity_ids` updates with book validation and maintains student assignment data integrity.

### Refactoring Performed

No refactoring performed during this review.

### Compliance Check

- Coding Standards: âœ“ Components follow project patterns
- Project Structure: âœ“ Files in correct locations
- Testing Strategy: âœ— Missing unit tests for new components
- All ACs Met: âœ— AC 14-20 (zoom controls) were descoped during implementation

### Improvements Checklist

- [ ] Add unit tests for ZoomControls.tsx component
- [ ] Add unit tests for BookListView.tsx component
- [ ] Add unit tests for EditActivitiesDialog.tsx component
- [ ] Clarify zoom AC requirements (14-20) - either formally descope or re-implement
- [ ] Fix pre-existing TypeScript errors in play.tsx (not from this story)

### Security Review

- âœ“ Backend validates teacher ownership before assignment update
- âœ“ Backend validates all activities belong to assignment's book
- âœ“ Authenticated image loading with proper blob URL cleanup
- No security concerns identified

### Performance Considerations

- âœ“ Efficient image loading with lazy loading patterns
- âœ“ Proper cleanup of blob URLs on unmount
- âœ“ Query caching with appropriate stale times
- No performance concerns identified

### Files Modified During Review

None - review only.

### Gate Status

Gate: CONCERNS â†’ docs/qa/gates/9.8-teacher-ui-enhancements.yml

**Key Issues:**
1. Missing unit tests for new UI components (medium severity)
2. Zoom functionality (AC 14-20) appears descoped without story update (low severity)

### Recommended Status

âœ— Changes Required - See unchecked items above

**Recommendation:** The core functionality works well. Before closing:
1. Add basic component tests for the 3 new UI components
2. Update story to formally remove or keep zoom ACs based on product decision

(Story owner decides final status)
