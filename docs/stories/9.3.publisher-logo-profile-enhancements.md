# Story 9.3: Publisher Logo & Profile Enhancements

**Epic:** 9 - UX Improvements & Polish
**Story ID:** 9.3
**Status:** Done
**Created:** 2025-12-03
**Priority:** Low

---

## Story

**As a** Publisher,
**I want** to see my organization's logo prominently displayed and have quick access to messaging teachers,
**so that** I have a branded experience and can easily communicate with teachers.

---

## Acceptance Criteria

### Publisher Logo Display
1. Publisher sees their organization logo in the sidebar/navbar area
2. Logo also displays on Publisher's profile/dashboard page
3. If no logo is set, shows organization name or placeholder
4. Logo is appropriately sized for each location (icon size in nav, larger on profile)

### Remove Add Book Button
5. "Add Book" button is removed from Publisher's books view
6. Books are managed through external system (Dream Central) only
7. Publisher can view books but not add new ones through LMS

### Teacher Messaging Quick Action
8. In Publisher's Teachers list view, each teacher card has a "Message" button
9. Clicking "Message" opens the messaging interface with that teacher pre-selected
10. Publisher can quickly send a message without navigating away
11. Button uses message/chat icon for clarity

---

## Tasks / Subtasks

### Frontend Tasks - Logo Display

- [x] **Task 1: Display Publisher Logo in Sidebar** (AC: 1, 3, 4)
  - [x] Fetch publisher profile data including logo_url on app load
  - [x] Add logo display area in Publisher sidebar (top section)
  - [x] If logo exists, display at appropriate size (~40x40 in sidebar)
  - [x] If no logo, display organization name or initials badge
  - [x] Style to match sidebar design

- [x] **Task 2: Display Publisher Logo on Profile/Dashboard** (AC: 2, 4)
  - [x] Add logo display to Publisher dashboard header area
  - [x] Larger size here (~120x120 or responsive)
  - [x] Show organization name alongside logo
  - [x] Fallback to initials/placeholder if no logo

### Frontend Tasks - Remove Add Book

- [x] **Task 3: Remove Add Book Button from Publisher View** (AC: 5, 6, 7)
  - [x] Locate "Add Book" button in Publisher's books view
  - [x] Remove the button component
  - [x] Remove any associated dialog/form code
  - [x] Ensure books list remains functional (view-only)
  - [x] Add informational text if needed: "Books are managed in Dream Central"

### Frontend Tasks - Teacher Messaging

- [x] **Task 4: Add Message Button to Teacher Cards** (AC: 8, 9, 10, 11)
  - [x] Locate Teacher list/cards in Publisher view
  - [x] Add "Message" icon button to each teacher card
  - [x] Use appropriate icon (MessageSquare, Chat, or similar)
  - [x] On click, navigate to messaging page with teacher_id as query param
  - [x] Or open messaging dialog/modal with teacher pre-selected
  - [x] Ensure messaging system accepts pre-selected recipient

- [x] **Task 5: Update Messaging to Accept Pre-Selected Recipient** (AC: 9)
  - [x] Modify messaging page/component to accept `recipient_id` query param (already implemented)
  - [x] If recipient_id provided, auto-select that user in conversation list (already implemented)
  - [x] If new conversation, start new thread with that user (already implemented)
  - [x] Focus on message input for quick typing (already implemented)

---

## Technical Notes

### Logo URL Source
- Logo URL comes from Publisher profile (set by Admin in Story 9.2)
- Endpoint: `GET /api/v1/users/me` should include publisher's logo_url
- May need to add publisher organization details to user profile response

### Messaging Integration
- Messaging system already exists from Epic 6
- Need to verify messaging page can handle query params
- Route pattern: `/messaging?recipient={teacher_id}` or `/messaging/{teacher_id}`

---

## Dependencies

- Story 9.2 (Admin sets publisher logo - logo must exist to display)
- Epic 6 Story 6.3 (Messaging system must be implemented)

---

## Estimation

- **Complexity:** Low
- **Components:** Mostly UI updates, minimal backend changes

---

## Dev Agent Record

### Agent Model Used
- Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References
- No debug issues encountered

### Completion Notes
1. **Backend Changes:**
   - Added new endpoint `GET /api/v1/publishers/me/profile` to fetch publisher profile including logo_url
   - Returns PublisherPublic model with all organization details

2. **Frontend Changes:**
   - Created new `publishersApi.ts` service for publisher profile fetching
   - Updated `SidebarItems.tsx` to display publisher logo in sidebar (with fallback to initials)
   - Updated `publisher/dashboard.tsx` to show large logo in header
   - Modified `publisher/library.tsx` to remove Add Book button and add publisher logo in header
   - Enhanced `publisher/teachers.tsx` with Message button on each teacher card

3. **Key Implementation Details:**
   - Logo sizing: 40x40 in sidebar, 96x96 on dashboard, 64x64 on library page
   - Fallback displays organization initials with teal gradient background
   - Message button navigates to `/messaging?user={teacher_user_id}`
   - Task 5 was already implemented - messaging page accepts `?user=` query param

### File List
**New Files:**
- `frontend/src/services/publishersApi.ts` - Publisher profile API service

**Modified Files:**
- `backend/app/api/routes/publishers.py` - Added `/me/profile` endpoint
- `frontend/src/components/Common/SidebarItems.tsx` - Added publisher logo display
- `frontend/src/routes/_layout/publisher/dashboard.tsx` - Added logo in header
- `frontend/src/routes/_layout/publisher/library.tsx` - Removed Add Book button, added info banner
- `frontend/src/routes/_layout/publisher/teachers.tsx` - Added Message button to teacher cards

### Change Log
- 2025-12-04: Implemented all 5 tasks, story marked as Ready for Review

---

## QA Results

### Review Date: 2025-12-04

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

The implementation is clean, well-structured, and follows project conventions. All 11 acceptance criteria are fully met:

**Publisher Logo Display (AC 1-4):**
- Logo displays correctly in sidebar at 40x40 size with proper OpenAPI.BASE URL prefix
- Dashboard shows larger logo (96x96) with organization name
- Library page shows medium logo (64x64) in header
- Fallback to initials badge with teal gradient when no logo exists

**Remove Add Book Button (AC 5-7):**
- Add Book button completely removed from library.tsx
- Publisher can view books in read-only mode
- Appropriate empty state messaging when no books

**Teacher Messaging Quick Action (AC 8-11):**
- Message button added to each teacher card with MessageSquare icon
- Button navigates to `/messaging?user={teacher_user_id}`
- Messaging page properly handles the `user` search param via useEffect
- Pre-selected recipient functionality verified as already implemented

### Refactoring Performed

None required - implementation is clean and follows project patterns.

### Compliance Check

- Coding Standards: ✓ Follows project conventions (Tailwind CSS, shadcn/ui components, TanStack Query patterns)
- Project Structure: ✓ New service file in correct location, routes follow file-based routing conventions
- Testing Strategy: ✓ Existing tests exist for publisher endpoints (though need username field updates)
- All ACs Met: ✓ All 11 acceptance criteria verified as implemented

### Improvements Checklist

- [x] Publisher logo displays in sidebar with fallback
- [x] Publisher logo displays on dashboard with organization name
- [x] Logo displays on library page header
- [x] Add Book button removed from library view
- [x] Message button added to teacher cards
- [x] Messaging integration verified working
- [ ] Pre-existing test file (test_api_publishers.py) needs username field updates (not story 9.3 scope)
- [ ] Consider adding specific tests for /me/profile endpoint (future improvement)
- [ ] Consider caching publisher profile in context to reduce duplicate fetches (optimization)

### Security Review

**Status: PASS**
- Backend endpoint uses proper RBAC with `require_role(UserRole.publisher)`
- Only authenticated publishers can access their own profile
- Logo URL is constructed properly with OpenAPI.BASE prefix

### Performance Considerations

**Status: PASS**
- Profile query uses staleTime: 5 * 60 * 1000 (5 minutes) for efficient caching
- Logo images are appropriately sized for each context (40x40, 64x64, 96x96)
- No unnecessary re-renders observed

### Files Modified During Review

None - no refactoring required.

### Gate Status

Gate: PASS → docs/qa/gates/9.3-publisher-logo-profile-enhancements.yml

### Recommended Status

✓ Ready for Done

All acceptance criteria have been verified as implemented. The implementation is clean, secure, and follows project patterns. Minor future improvements identified (test updates, profile caching) are out of scope for this story.
